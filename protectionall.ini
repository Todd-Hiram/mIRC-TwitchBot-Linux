n0=alias sticky {
n1=  var %re = /(.)\1{ [ $+ [ %protectionspam ] $+ ] ,}/
n2=  return $iif($regex($1-,%re), $regml(1), $null)
n3=}
n4=
n5=on *:text:!protection*:#:{
n6=  if (($right(#,-1) == $nick) && ( $2 == default ) && ( $3 == set )) {
n7=    set %protection. [ $+ [ # ] $+ ] .caps.status on
n8=    set %protection. [ $+ [ # ] $+ ] .emotes.status on
n9=    set %protection. [ $+ [ # ] $+ ] .spam.status on
n10=    set %protection. [ $+ [ # ] $+ ] .links.status on
n11=    set %protection. [ $+ [ # ] $+ ] .repeat.status on
n12=    set %protection. [ $+ [ # ] $+ ] .blacklist.status on
n13=    set %protection. [ $+ [ # ] $+ ] .symbol.status on
n14=    set %protection. [ $+ [ # ] $+ ] .fakedonation.status on
n15=    set %protection. [ $+ [ # ] $+ ] .silent off
n16=    set %protection. [ $+ [ # ] $+ ] .caps.message Easy on the caps please.
n17=    set %protection. [ $+ [ # ] $+ ] .emotes.message Easy on the emotes please.  
n18=    set %protection. [ $+ [ # ] $+ ] .symbol.message Easy on the symbols please. 
n19=    set %protection. [ $+ [ # ] $+ ] .links.message Leave the links to the moderators please.
n20=    set %protection. [ $+ [ # ] $+ ] .repeat.message Please stop repeating.
n21=    set %protection. [ $+ [ # ] $+ ] .spam.message Please don't spam.
n22=    set %protection. [ $+ [ # ] $+ ] .blacklist.message Keep it PG please.
n23=    set %protection. [ $+ [ # ] $+ ] .fakedonation.message Please don't lie to get attention.
n24=    set %protection. [ $+ [ # ] $+ ] .caps.limitamount 8 
n25=    set %protection. [ $+ [ # ] $+ ] .emotes.limitamount 8
n26=    set %protection. [ $+ [ # ] $+ ] .symbol.limitamount 10
n27=    set %protection. [ $+ [ # ] $+ ] .repeat.limitamount 5
n28=    set %protection. [ $+ [ # ] $+ ] .spam.limitamount 16
n29=    set %protection. [ $+ [ # ] $+ ] .caps.limitpercentage 80
n30=    set %protection. [ $+ [ # ] $+ ] .symbol.limitpercentage 90 
n31=    set %protection. [ $+ [ # ] $+ ] .spam.limitpercentage 90
n32=    set %protection. [ $+ [ # ] $+ ] .caps.timeout 1
n33=    set %protection. [ $+ [ # ] $+ ] .emotes.timeout 1
n34=    set %protection. [ $+ [ # ] $+ ] .spam.timeout 1
n35=    set %protection. [ $+ [ # ] $+ ] .links.timeout 1
n36=    set %protection. [ $+ [ # ] $+ ] .repeat.timeout 1
n37=    set %protection. [ $+ [ # ] $+ ] .blacklist.timeout 1
n38=    set %protection. [ $+ [ # ] $+ ] .symbol.timeout 1
n39=    set %protection. [ $+ [ # ] $+ ] .fakedonation.timeout 1
n40=    set %streamer. [ $+ [ # ] $+ ] .bits.message 
n41=    set %streamer. [ $+ [ # ] $+ ] .bits.amount 1
n42=    msg # The bot's default settings has been set for this channel.
n43=    break
n44=  }
n45=  elseif ($msgtags(mod).key == 1 || $right(#,-1) == $nick) {
n46=    if ($2 != caps && $2 != emotes && $2 != symbol && $2 != spam && $2 != repeat && $2 != blacklist && $2 != links && $2 != silent && $2 != fakedonation ) { goto failure }
n47=    elseif ($3 != on && $3 != off && $3 != message && $3 != limitamount && $3 != limitpercentage && $3 != add && $3 != del && $3 != whitelist && $3 != timeout && $3 != regular && $3 != sub) { goto failure }
n48=    elseif (($2 == blacklist || $2 == links || $2 == fakedonation) && ( $3 == limitamount || $3 == limitpercentage)) { goto failure }
n49=    elseif (($2 != links) && ($3 == whitelist )) { goto failure }
n50=    elseif (($2 != emotes && $2 != blacklist && $2 != links) && ($3 == add || $3 == del)) { goto failure }
n51=    elseif (($3 == timeout) && ($4 !isnum || $4 == 0)) { goto failure }
n52=    elseif (($2 == repeat || $2 == emotes || $2 == spam ) && ($3 == limitpercentage)) { goto failure } 
n53=    elseif (($3 == regular) && ($4 != On && $4 != off)) { goto failure }
n54=    elseif (($3 == regular) && ($4 == On || $4 == off) && ( %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] .regular == $4)) { 
n55=      msg # Regulars are already protected in reference to $2 $+ .
n56=      break
n57=    }
n58=    elseif (($3 == sub) && ($4 != On && $4 != off)) { goto failure }
n59=    elseif (($3 == sub ) && ($4 == On || $4 == off) && ( %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] .sub == $4)) { 
n60=      msg # Subscribers are already protected in reference to $2 $+ .
n61=      break
n62=    }
n63=    elseif (( $2 != silent) && ($3 == On || $3 == Off )) && ( %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] .status == $3)) {
n64=      msg # /me $nick $+ , $2 protection is already $3 $+ .
n65=      break
n66=    }
n67=    elseif (($2 == Silent) && ($3 != on && $3 != off )) { goto failure }
n68=    elseif (($2 == Silent) && ($3 == On || $3 == Off )  && ( %protection. [ $+ [ # ] $+ ] .silent == $3 )) {
n69=      msg # /me $nick $+ , Silent mode is already $3 $+ .
n70=      break
n71=    }
n72=    elseif (($2 == Silent) && ($3 == On || $3 == Off )) {
n73=      set %protection. [ $+ [ # ] $+ ] .silent $3 
n74=      msg # /me $nick $+ , Silent mode is now $3 $+ .
n75=      break
n76=    }
n77=    else {
n78=      if ( $3 == On || $3 == Off ) {
n79=        set %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] .status $3
n80=        msg # $nick $+ , $2 protection has been turned $3 $+ .
n81=        break
n82=      }
n83=      elseif ($3 == add || $3 == del) {
n84=        var %file $2 $+ .ini
n85=        if ($3 == add) {
n86=          if ($ini(%file,#,$4) == $null) {
n87=            writeini %file # $4 1
n88=            if (emotes == $2) { msg # /me $4 will no longer be counted against the maximum emote limit. }
n89=            else { msg # /me $4 has been added to $2 $+ . }
n90=          }
n91=          else {
n92=            msg # /me $4 is already in $2 $+ . 
n93=          }
n94=        }
n95=        elseif ($3 == del) {
n96=          if ($ini(%file,#,$4) != $null) {
n97=            remini %file # $4
n98=            if (emotes == $2) { msg # /me $4 will be counted against the maximum emote limit. }
n99=            else { msg # /me $4 has been removed from $2 $+ . }
n100=          }
n101=          else {
n102=            msg # Sorry, $4 was not found in $2 $+ .
n103=          }
n104=        }
n105=      }
n106=      elseif ($3 == whitelist) && ($4 == add || $4 == del) {
n107=        var %file $3 $+ .ini
n108=        if ($4 == add) {
n109=          if ($ini(%file,#,$5) == $null) {
n110=            writeini %file # $5 1
n111=            msg # /me $5 has been added to $3 $+ .
n112=          }
n113=          else {
n114=            msg # /me $5 is already in $3 $+ .
n115=          }
n116=        }
n117=        elseif ($4 == del) {
n118=          if ($ini(%file,#,$5) != $null) {
n119=            remini %file # $5
n120=            msg # /me $5 has been removed from $3 $+ .
n121=          }
n122=        }
n123=      }
n124=      else {
n125=        set %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] . [ $+ [ $3 ] ] $4-
n126=        msg # $nick $+ , $3 has been set for $2 $+ . 
n127=        halt
n128=        :failure
n129=        msg # $nick For more info about how to set the protection settings, visit [link].
n130=        break
n131=      }
n132=    }
n133=  }
n134=}
n135=
n136=on *:text:!permit*:#: {
n137=  if ($msgtags(mod).key == 1 || $right(#,-1) == $nick) {
n138=    set -u30 %permit $addtok(%permit,$2,32)
n139=    msg $chan You have 30 seconds to post a link, $2
n140=  }
n141=}
n142=
n143=on *:TEXT:*:#: {
n144=  if ($msgtags(mod).key == 1) { return }
n145=  if ($nick == $right(#,-1)) { return }
n146=  var %pmessage $1-
n147=  var %emotecount 0
n148=  var %plines $numtok($1-,32)
n149=  while (%plines) {
n150=    if ($read(allemotes.txt, ns, $gettok(%pmessage,%plines,32)) != $null) {
n151=      var %readn $readn
n152=      if ($gettok(%pmessage,%plines,32) 1 === $read(allemotes.txt,n,%readn)) {
n153=        set %pmessage $deltok(%pmessage,%plines,32)
n154=        var %emotecount $calc(%emotecount + 1)
n155=      }
n156=    }
n157=    dec %plines
n158=  } 
n159=  if (%protection. [ $+ [ # ] $+ ] .links.status == On ) {
n160=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .links.regular == On )) { return }
n161=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .links.sub == On ) { return }
n162=    if ($istok(%permit,$nick,32)) { return }
n163=    var %q = 1 | while $ini(links.ini, # ,%q) {
n164=      var %listl = %listl $v1
n165=      inc %q
n166=    }
n167=    var %g = 0
n168=    while (%g < $numtok(%listl,32)) {
n169=      inc %g
n170=      var %link = $gettok(%listl,%g,32)
n171=      if (%link isin $1-) {
n172=        var %w = 1 | while $ini(whitelist.ini,#,%w) {
n173=          var %listwl = %listwl $v1
n174=          inc %w
n175=        }
n176=        var %wl = 0
n177=        while (%wl < $numtok(%listwl,32)) {
n178=          inc %wl
n179=          var %wli = $gettok(%listwl,%wl,32)
n180=          if (%wli isin $1-) {
n181=            goto continuingprotection
n182=          }
n183=        }
n184=        var %fff = 1 | while $ini(pun.ini,pun,%fff) {
n185=          var %listp = %listp $v1
n186=          inc %fff
n187=        }
n188=        var %ggg = 0
n189=        while (%ggg < $numtok(%listp,32)) {
n190=          inc %ggg
n191=          var %ddd  $gettok(%listp,%ggg,32)
n192=          if (%link $+ %ddd isin $1-) { goto linktimeout }
n193=          elseif (%ddd $+ %link isin $1-) { goto stop } 
n194=        }  
n195=        elseif ($chr(32) $+ %link iswm $1-) { goto linktimeout }
n196=        if (* $+ %link $+ & iswm $1- ) {
n197=          :stop
n198=          goto continuingprotection
n199=        }
n200=        else {
n201=          :linktimeout
n202=          msg # .timeout $nick %protection. [ $+ [ # ] $+ ] .links.timeout No links please.
n203=          if (%protection. [ $+ [ # ] $+ ] .silent == Off) {
n204=            if ((%floodlinks) || ($($+(%,floodlinks.,$2),2))) { return } 
n205=            msg #  $nick $+ , %protection. [ $+ [ # ] $+ ] .links.message
n206=            set -u15 %floodlinks On
n207=          }
n208=          break
n209=        }
n210=      } 
n211=    }
n212=  }
n213=  :continuingprotection
n214=  if (%protection. [ $+ [ # ] $+ ] .emotes.status == On ) {
n215=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .emotes.regular == On )) { return }
n216=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .emotes.sub == On ) { return }
n217=    var %emotemessage = $1-
n218=    var %i = 1 | while $ini(emotes.ini,#,%i) {
n219=      var %list = %list $v1
n220=      inc %i
n221=    }
n222=    var %j = 0
n223=    while (%j < $numtok(%list,32)) {
n224=      inc %j 
n225=      var %words = $gettok(%list,%j,32)
n226=      var %p $countcs($strip($1-),%words)
n227=      var %emotecount $calc(%emotecount - %p)
n228=    }
n229=    if (%emotecount >= %protection. [ $+ [ # ] $+ ] .emotes.limitamount ) {
n230=      msg # /timeout $nick %protection. [ $+ [ # ] $+ ] .emotes.timeout Easy on the emotes please. 
n231=      if (%protection. [ $+ [ # ] $+ ] .silent == Off) {
n232=        if ((%floodemotes) || ($($+(%,floodemotes.,$2),2))) { return } 
n233=        msg $chan $nick $+ , %protection. [ $+ [ # ] $+ ] .emotes.message
n234=        set -u15 %floodemotes On
n235=      }      
n236=      break
n237=    }
n238=  }
n239=
n240=  if (%protection. [ $+ [ # ] $+ ] .caps.status == On ) {
n241=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .caps.regular == On )) { return }
n242=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .caps.sub == On ) { return }
n243=    if ( $len(%pmessage) >= %protection. [ $+ [ # ] $+ ] .caps.limitamount ) {
n244=      if ( $calc($regex([$+ [ %pmessage ] $+ ],/[A-Z]/g) / $regex([$+ [ %pmessage ] $+ ],/[A-Z]/gi) * 100) >= %protection. [ $+ [ # ] $+ ] .caps.limitpercentage ) {
n245=        msg # /timeout $nick %protection. [ $+ [ # ] $+ ] .caps.timeout Easy on the caps please.
n246=        if (%protection. [ $+ [ # ] $+ ] .silent == Off) {
n247=          if ((%floodcaps) || ($($+(%,floodcaps.,$2),2))) { return } 
n248=          msg # $nick $+ , %protection. [ $+ [ # ] $+ ] .caps.message
n249=          set -u15 %floodcaps On
n250=        }
n251=        halt
n252=      }
n253=    }
n254=  }
n255=
n256=  if (%protection. [ $+ [ # ] $+ ] .symbol.status == On ) {
n257=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .sybmbol.regular == On )) { return }
n258=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .symbol.sub == On ) { return }
n259=    if ( $len(%pmessage) >= %protection. [ $+ [ # ] $+ ] .symbol.limitamount ) {
n260=      if ( $calc( $regex([ $+ [ %pmessage ] $+ ],/[^a-z0-9]/gi) * 100 / $len(%pmessage) ) >= %protection. [ $+ [ # ] $+ ] .symbol.limitpercentage ) {
n261=        msg $chan .timeout $nick %protection. [ $+ [ # ] $+ ] .symbol.timeout Easy on the symbols please.
n262=        if (%protection. [ $+ [ # ] $+ ] .silent == Off) {
n263=          if ((%floodsymbols) || ($($+(%,floodsymbols.,$2),2))) { return } 
n264=          msg #  $nick $+ , %protection. [ $+ [ # ] $+ ] .symbol.message
n265=          set -u15 %floodsymbols On
n266=        }
n267=        halt
n268=      }
n269=    }
n270=  } 
n271=  if (%protection. [ $+ [ # ] $+ ] .repeat.status == On ) {
n272=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .repeat.regular == On )) { return }
n273=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .repeat.sub == On ) { return }
n274=    if ($1- == $readini(RepeatedMessages.ini,#, $nick)) {
n275=      var %times $calc($readini(RepeatedMessagesTimes.ini, #, $nick) + 1)
n276=      if (%times >= %protection. [ $+ [ # ] $+ ] .repeat.limitamount) {
n277=        msg # /timeout $nick %protection. [ $+ [ # ] $+ ] .repeat.timeout Please stop repeating.
n278=        if (%protection. [ $+ [ # ] $+ ] .silent == Off) {
n279=          if ((%floodrepeat) || ($($+(%,floodrepeat.,$2),2))) { return } 
n280=          msg #  $nick $+ , %protection. [ $+ [ # ] $+ ] .repeat.message
n281=          set -u15 %floodrepeat On
n282=        }
n283=        writeini RepeatedMessagesTimes.ini # $nick %times
n284=        halt
n285=      }
n286=      else {
n287=        writeini RepeatedMessagesTimes.ini # $nick %times
n288=      }
n289=    }
n290=    else {
n291=      writeini RepeatedMessagesTimes.ini # $nick 1
n292=      writeini RepeatedMessages.ini # $nick $1-
n293=    }
n294=  }
n295=  if (%protection. [ $+ [ # ] $+ ] .spam.status == On ) {
n296=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .spam.regular == On )) { return }
n297=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .spam.sub == On ) { return }
n298=    var %spam = 1
n299=    while ($gettok($1-, %spam, 32) != $null) {
n300=      var %word = $v1
n301=      var %protectionspam. %protection. [ $+ [ # ] $+ ] .spam.limitamount
n302=      set %protectionspam %protectionspam.
n303=      if ($sticky(%word) != $null) {
n304=        msg $chan .timeout $nick %protection. [ $+ [ # ] $+ ] .spam.timeout Please stop spamming.
n305=        if (%floodspam || ($($+(%,floodspam.,$2),2))) { return } 
n306=        if (%protection. [ $+ [ # ] $+ ] .silent == Off) {
n307=          msg #  $nick $+ , %protection. [ $+ [ # ] $+ ] .spam.message
n308=          set -u15 %floodspam On
n309=        }
n310=        break
n311=      }
n312=      inc %spam
n313=    }
n314=  }
n315=  if (%protection. [ $+ [ # ] $+ ] .blacklist.status == On ) {
n316=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .blacklist.regular == On )) { return }
n317=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .blacklist.sub == On ) { return }
n318=    if ($chr(42) $+ $chr(42) $+ $chr(42) == $1-) { goto timeout }
n319=    if ($chr(32) $+ $chr(42) $+ $chr(42) $+ $chr(42) $+ $chr(32) isin $1- ) { goto timeout }
n320=    var %blackcount = 1 | while $ini(blacklist.ini,#,%blacklist) {
n321=      var %blacklistlist = %blacklistlistlist $v1
n322=      inc %blackcount
n323=    }
n324=    var %black = 0
n325=    while (%black < $numtok(%blacklistlist,32)) {
n326=      inc %black
n327=      var %words = $gettok(%blacklistlist,%black,32)
n328=      var %blackamount = $countcs($strip($1-),%words)     
n329=      if (%blackamount >= 1) {
n330=        :timeout
n331=        msg # /timeout $nick %protection. [ $+ [ # ] $+ ] .blacklist.timeout Please keep it PG. 
n332=        if ((%floodblacklist) || ($($+(%,floodblacklist.,$2),2))) { return } 
n333=        if (%protection. [ $+ [ # ] $+ ] .silent == Off)  {
n334=          msg $chan  $nick $+ , %protection. [ $+ [ # ] $+ ] .blacklist.message
n335=          set -u15 %floodblacklist On
n336=        }      
n337=        break
n338=      }
n339=    }
n340=  }
n341=}
n342=
n343=on *:action:*:#:{
n344=  if ($msgtags(mod).key == 1) { return }
n345=  if (Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .fakedonation.regular == On )) { return }
n346=  if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .fakedonation.sub == On ) { return }
n347=  if (%protection. [ $+ [ # ] $+ ] .fakedonation.status == Off ) { return }
n348=  if ( $ isin $1- || donate isin $1-) {
n349=    if (%protection. [ $+ [ # ] $+ ] .silent == Off) {
n350=      msg $chan  $nick $+ , %protection. [ $+ [ # ] $+ ] .fakedonation.message
n351=    }
n352=    msg # /timeout $nick %protection. [ $+ [ # ] $+ ] .fakedonation.timeout No fake donations here
n353=  }
n354=}
