[script]
n0=alias sticky {
n1=  var %re = /(.)\1{ [ $+ [ %protectionspam ] $+ ] ,}/
n2=  return $iif($regex($1-,%re), $regml(1), $null)
n3=}
n4=alias caps {
n5=  var %caps = $calc($regex($1-,/[A-Z]/g) / $regex($1-,/[A-Z]/gi) * 100)
n6=  return %caps
n7=}
n8=alias symbols {
n9=  var %symbols = $calc($regex($1-,/[^a-z0-9]/gi) * 100 / $len($1-))
n10=  return %symbols
n11=}
n12=alias timeout {
n13=  var %message = %protection. [ $+ [ $1 ] $+ . $+ [ $2 ] $+ ] .message 
n14=  var %timeout = %protection. [ $+ [ $1 ] $+ . $+ [ $2 ] $+ ] .timeout
n15=  msg $1 .timeout $3 %timeout %message
n16=  if (%protection. [ $+ [ $1 ] $+ ] .silent == Off) {
n17=    if (%flood. [ $+ [ $1 ] $+ . $+ [ $2 ] ]) { return } 
n18=    msg $1  $3 $+ , %message
n19=    set -u15 %flood. [ $+ [ $1 ] $+ . $+ [ $2 ] ] On
n20=  }
n21=  return
n22=}
n23=
n24=on *:text:!protection*:#:{
n25=  if ($right(#,-1) == $nick) && ( $2 == default ) && ( $3 == set )) {
n26=    set %protection. [ $+ [ # ] $+ ] .caps.status on
n27=    set %protection. [ $+ [ # ] $+ ] .emotes.status on
n28=    set %protection. [ $+ [ # ] $+ ] .spam.status on
n29=    set %protection. [ $+ [ # ] $+ ] .links.status on
n30=    set %protection. [ $+ [ # ] $+ ] .repeat.status on
n31=    set %protection. [ $+ [ # ] $+ ] .blacklist.status on
n32=    set %protection. [ $+ [ # ] $+ ] .symbol.status on
n33=    set %protection. [ $+ [ # ] $+ ] .fakedonation.status on
n34=    set %protection. [ $+ [ # ] $+ ] .silent off
n35=    set %protection. [ $+ [ # ] $+ ] .caps.message Easy on the caps please.
n36=    set %protection. [ $+ [ # ] $+ ] .emotes.message Easy on the emotes please.  
n37=    set %protection. [ $+ [ # ] $+ ] .symbol.message Easy on the symbols please. 
n38=    set %protection. [ $+ [ # ] $+ ] .links.message Leave the links to the moderators please.
n39=    set %protection. [ $+ [ # ] $+ ] .repeat.message Please stop repeating.
n40=    set %protection. [ $+ [ # ] $+ ] .spam.message Please don't spam.
n41=    set %protection. [ $+ [ # ] $+ ] .blacklist.message Keep it PG please.
n42=    set %protection. [ $+ [ # ] $+ ] .fakedonation.message Please don't lie to get attention.
n43=    set %protection. [ $+ [ # ] $+ ] .caps.limitamount 8 
n44=    set %protection. [ $+ [ # ] $+ ] .emotes.limitamount 8
n45=    set %protection. [ $+ [ # ] $+ ] .symbol.limitamount 10
n46=    set %protection. [ $+ [ # ] $+ ] .repeat.limitamount 5
n47=    set %protection. [ $+ [ # ] $+ ] .spam.limitamount 16
n48=    set %protection. [ $+ [ # ] $+ ] .caps.limitpercentage 80
n49=    set %protection. [ $+ [ # ] $+ ] .symbol.limitpercentage 90 
n50=    set %protection. [ $+ [ # ] $+ ] .spam.limitpercentage 90
n51=    set %protection. [ $+ [ # ] $+ ] .caps.timeout 1
n52=    set %protection. [ $+ [ # ] $+ ] .emotes.timeout 1
n53=    set %protection. [ $+ [ # ] $+ ] .spam.timeout 1
n54=    set %protection. [ $+ [ # ] $+ ] .links.timeout 1
n55=    set %protection. [ $+ [ # ] $+ ] .repeat.timeout 1
n56=    set %protection. [ $+ [ # ] $+ ] .blacklist.timeout 1
n57=    set %protection. [ $+ [ # ] $+ ] .symbol.timeout 1
n58=    set %protection. [ $+ [ # ] $+ ] .fakedonation.timeout 1
n59=    set %streamer. [ $+ [ # ] $+ ] .bits.message 
n60=    set %streamer. [ $+ [ # ] $+ ] .bits.amount 1
n61=    msg # The bot's default settings has been set for this channel.
n62=    break
n63=  }
n64=  elseif ($msgtags(mod).key == 1 || $right(#,-1) == $nick) {
n65=    if ($2 != caps && $2 != emotes && $2 != symbol && $2 != spam && $2 != repeat && $2 != blacklist && $2 != links && $2 != silent && $2 != fakedonation ) { goto failure }
n66=    elseif ($3 != on && $3 != off && $3 != message && $3 != limitamount && $3 != limitpercentage && $3 != add && $3 != del && $3 != whitelist && $3 != timeout && $3 != regular && $3 != sub) { goto failure }
n67=    elseif (($2 == blacklist || $2 == links || $2 == fakedonation) && ( $3 == limitamount || $3 == limitpercentage)) { goto failure }
n68=    elseif (($2 != links) && ($3 == whitelist )) { goto failure }
n69=    elseif (($2 != emotes && $2 != blacklist && $2 != links) && ($3 == add || $3 == del)) { goto failure }
n70=    elseif (($3 == timeout) && ($4 !isnum || $4 == 0)) { goto failure }
n71=    elseif (($2 == repeat || $2 == emotes || $2 == spam ) && ($3 == limitpercentage)) { goto failure } 
n72=    elseif (($3 == regular) && ($4 != On && $4 != off)) { goto failure }
n73=    elseif (($3 == regular) && ($4 == On || $4 == off) && ( %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] .regular == $4)) { 
n74=      msg # Regulars are already protected in reference to $2 $+ .
n75=      break
n76=    }
n77=    elseif (($3 == sub) && ($4 != On && $4 != off)) { goto failure }
n78=    elseif (($3 == sub ) && ($4 == On || $4 == off) && ( %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] .sub == $4)) { 
n79=      msg # Subscribers are already protected in reference to $2 $+ .
n80=      break
n81=    }
n82=    elseif (( $2 != silent) && ($3 == On || $3 == Off )) && ( %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] .status == $3)) {
n83=      msg # /me $nick $+ , $2 protection is already $3 $+ .
n84=      break
n85=    }
n86=    elseif (($2 == Silent) && ($3 != on && $3 != off )) { goto failure }
n87=    elseif (($2 == Silent) && ($3 == On || $3 == Off )  && ( %protection. [ $+ [ # ] $+ ] .silent == $3 )) {
n88=      msg # /me $nick $+ , Silent mode is already $3 $+ .
n89=      break
n90=    }
n91=    elseif (($2 == Silent) && ($3 == On || $3 == Off )) {
n92=      set %protection. [ $+ [ # ] $+ ] .silent $3 
n93=      msg # /me $nick $+ , Silent mode is now $3 $+ .
n94=      break
n95=    }
n96=    else {
n97=      if ( $3 == On || $3 == Off ) {
n98=        set %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] .status $3
n99=        msg # $nick $+ , $2 protection has been turned $3 $+ .
n100=        break
n101=      }
n102=      elseif ($3 == add || $3 == del) {
n103=        var %file $2 $+ .ini
n104=        if ($3 == add) {
n105=          if ($ini(%file,#,$4) == $null) {
n106=            writeini %file # $4 1
n107=            if (emotes == $2) { msg # /me $4 will no longer be counted against the maximum emote limit. }
n108=            else { msg # /me $4 has been added to $2 $+ . }
n109=          }
n110=          else {
n111=            msg # /me $4 is already in $2 $+ . 
n112=          }
n113=        }
n114=        elseif ($3 == del) {
n115=          if ($ini(%file,#,$4) != $null) {
n116=            remini %file # $4
n117=            if (emotes == $2) { msg # /me $4 will be counted against the maximum emote limit. }
n118=            else { msg # /me $4 has been removed from $2 $+ . }
n119=          }
n120=          else {
n121=            msg # Sorry, $4 was not found in $2 $+ .
n122=          }
n123=        }
n124=      }
n125=      elseif ($3 == whitelist) && ($4 == add || $4 == del) {
n126=        var %file $3 $+ .ini
n127=        if ($4 == add) {
n128=          if ($ini(%file,#,$5) == $null) {
n129=            writeini %file # $5 1
n130=            msg # /me $5 has been added to $3 $+ .
n131=          }
n132=          else {
n133=            msg # /me $5 is already in $3 $+ .
n134=          }
n135=        }
n136=        elseif ($4 == del) {
n137=          if ($ini(%file,#,$5) != $null) {
n138=            remini %file # $5
n139=            msg # /me $5 has been removed from $3 $+ .
n140=          }
n141=        }
n142=      }
n143=      else {
n144=        set %protection. [ $+ [ # ] $+ ] . [ $+ [ $2 ] $+ ] . [ $+ [ $3 ] ] $4-
n145=        msg # $nick $+ , $3 has been set for $2 $+ . 
n146=        halt
n147=        :failure
n148=        msg # $nick For more info about how to set the protection settings, visit https://goo.gl/o1Otwc.
n149=        break
n150=      }
n151=    }
n152=  }
n153=}
n154=
n155=on *:text:!permit*:#: {
n156=  if ($msgtags(mod).key == 1 || $right(#,-1) == $nick) {
n157=    set -u30 %permit $addtok(%permit,$2,32)
n158=    msg $chan You have 30 seconds to post a link, $2
n159=  }
n160=}
n161=
n162=on *:TEXT:*:#: {
n163=  if ($msgtags(mod).key == 1) { return }
n164=  if ($nick == $right(#,-1)) { return }
n165=  set %pmessage $1-
n166=  if ($msgtags(emotes).key == $null) { goto continue }
n167=  var %emotecount 0
n168=  var %plines $numtok($1-,32)
n169=  var %i = 1 | while $ini(emotes.ini,#,%i) {
n170=    var %list = %list $v1
n171=    inc %i
n172=  }
n173=  var %j = 0
n174=  while (%j < $numtok(%list,32)) {
n175=    inc %j 
n176=    var %words = $gettok(%list,%j,32)
n177=    set %pmessage $remtok($strip(%pmessage),%words,0,32)
n178=  }
n179=  var %plines $numtok(%pmessage,32)
n180=  while (%plines) {
n181=    var %word $gettok(%pmessage,%plines,32)
n182=    if ($hget(allemotes,%word)) {
n183=      set %pmessage $deltok(%pmessage,%plines,32)
n184=      var %emotecount $calc(%emotecount + 1)
n185=    }
n186=    dec %plines
n187=  }
n188=  :continue
n189=  if (%protection. [ $+ [ # ] $+ ] .links.status == On ) {
n190=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .links.regular == On )) { return }
n191=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .links.sub == On ) { return }
n192=    if ($istok(%permit,$nick,32)) { return }
n193=    var %q = 1 | while $ini(links.ini, # ,%q) {
n194=      var %listl = %listl $v1
n195=      inc %q
n196=    }
n197=    var %g = 0
n198=    while (%g < $numtok(%listl,32)) {
n199=      inc %g
n200=      var %link = $gettok(%listl,%g,32)
n201=      if (%link isin $1-) {
n202=        var %w = 1 | while $ini(whitelist.ini,#,%w) {
n203=          var %listwl = %listwl $v1
n204=          inc %w
n205=        }
n206=        var %wl = 0
n207=        while (%wl < $numtok(%listwl,32)) {
n208=          inc %wl
n209=          var %wli = $gettok(%listwl,%wl,32)
n210=          if (%wli isin $1-) {
n211=            goto continuingprotection
n212=          }
n213=        }
n214=        var %fff = 1 | while $ini(pun.ini,pun,%fff) {
n215=          var %listp = %listp $v1
n216=          inc %fff
n217=        }
n218=        var %ggg = 0
n219=        while (%ggg < $numtok(%listp,32)) {
n220=          inc %ggg
n221=          var %ddd  $gettok(%listp,%ggg,32)
n222=          if (%link $+ %ddd isin $1-) { goto linktimeout }
n223=          elseif (%ddd $+ %link isin $1-) { goto stop } 
n224=        }  
n225=        elseif ($chr(32) $+ %link iswm $1-) { goto linktimeout }
n226=        if (* $+ %link $+ & iswm $1- ) {
n227=          :stop
n228=          goto continuingprotection
n229=        }
n230=        else {
n231=          :linktimeout
n232=          timeout $chan links $nick
n233=        }
n234=        break
n235=      }
n236=    } 
n237=  }
n238=  :continuingprotection
n239=  if (%protection. [ $+ [ # ] $+ ] .repeat.status == On ) {
n240=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .repeat.regular == On )) { return }
n241=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .repeat.sub == On ) { return }
n242=    if (%repeat.text. [ $+ [ $nick ] $+ . $+ [ $chan ] ] != $1- || %repeat.times. [ $+ [ $nick ] $+ ] . [ $+ [ $chan ] ] == $null ) {
n243=      set -u3600 %repeat.times. [ $+ [ $nick ] $+ ] . [ $+ [ $chan ] ] 1
n244=      set -u3600 %repeat.text. [ $+ [ $nick ] $+ ] . [ $+ [ $chan ] ] $1-
n245=      goto next
n246=    }
n247=    var %repeattext = %repeat.text. [ $+ [ $nick ] $+ ] . [ $+ [ $chan ] ]
n248=    if (%repeattext = $1-) {
n249=      inc %repeat.times. [ $+ [ $nick ] $+ . $+ [ $chan ] ]
n250=      var %repeats = %repeat.times. [ $+ [ $nick ] $+ . $+ [ $chan ] ]
n251=      if (%repeats >= %protection. [ $+ [ # ] $+ ] .repeat.limitamount) {
n252=        timeout $chan repeat $nick
n253=        break
n254=      }
n255=    }
n256=  }
n257=  :next
n258=  if (%protection. [ $+ [ # ] $+ ] .emotes.status == On ) {
n259=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .emotes.regular == On )) { return }
n260=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .emotes.sub == On ) { return }
n261=    if (%emotecount >= %protection. [ $+ [ # ] $+ ] .emotes.limitamount ) {
n262=      timeout $chan emotes $nick
n263=      break
n264=    }
n265=  }
n266=  if (%protection. [ $+ [ # ] $+ ] .caps.status == On ) {
n267=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .caps.regular == On )) { return }
n268=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .caps.sub == On ) { return }
n269=    if ( $len(%pmessage) >= %protection. [ $+ [ # ] $+ ] .caps.limitamount ) {
n270=      if ( $caps(%pmessage) >= %protection. [ $+ [ # ] $+ ] .caps.limitpercentage ) {
n271=        timeout $chan caps $nick
n272=        break
n273=      }
n274=    }
n275=  }
n276=  if (%protection. [ $+ [ # ] $+ ] .symbol.status == On ) {
n277=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .sybmbol.regular == On )) { return }
n278=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .symbol.sub == On ) { return }
n279=    if ( $len($1-) >= %protection. [ $+ [ # ] $+ ] .symbol.limitamount ) {
n280=      if ( $symbols(%pmessage) >= %protection. [ $+ [ # ] $+ ] .symbol.limitpercentage ) {
n281=        timeout $chan symbol $nick
n282=        halt
n283=      }
n284=    }
n285=  } 
n286=
n287=  if (%protection. [ $+ [ # ] $+ ] .spam.status == On ) {
n288=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .spam.regular == On )) { return }
n289=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .spam.sub == On ) { return }
n290=    var %spam = 1
n291=    while ($gettok($1-, %spam, 32) != $null) {
n292=      var %word = $v1
n293=      var %protectionspam. %protection. [ $+ [ # ] $+ ] .spam.limitamount
n294=      set %protectionspam %protectionspam.
n295=      if ($sticky(%word) != $null) {
n296=        timeout $chan spam $nick
n297=        break
n298=      }
n299=      inc %spam
n300=    }
n301=  }
n302=  if (%protection. [ $+ [ # ] $+ ] .blacklist.status == On ) {
n303=    if ((Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .blacklist.regular == On )) { return }
n304=    if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .blacklist.sub == On ) { return }
n305=    if ($chr(42) $+ $chr(42) $+ $chr(42) == $1-) { goto timeout }
n306=    if ($chr(32) $+ $chr(42) $+ $chr(42) $+ $chr(42) $+ $chr(32) isin $1- ) { goto timeout }
n307=    var %blackcount = 1 | while $ini(blacklist.ini,#,%blacklist) {
n308=      var %blacklistlist = %blacklistlistlist $v1
n309=      inc %blackcount
n310=    }
n311=    var %black = 0
n312=    while (%black < $numtok(%blacklistlist,32)) {
n313=      inc %black
n314=      var %words = $gettok(%blacklistlist,%black,32)
n315=      var %blackamount = $countcs($strip($1-),%words)     
n316=      if (%blackamount >= 1) {
n317=        :timeout
n318=        timeout $chan blacklist $nick     
n319=        break
n320=      }
n321=    }
n322=  }
n323=}
n324=
n325=on *:action:*:#:{
n326=  if ($msgtags(mod).key == 1) { return }
n327=  if (Regular. [ $+ [ # ] ] isin $level($nick)) && (%protection. [ $+ [ # ] $+ ] .fakedonation.regular == On )) { return }
n328=  if ($msgtags(subscriber).key == 1) && (%protection. [ $+ [ # ] $+ ] .fakedonation.sub == On ) { return }
n329=  if (%protection. [ $+ [ # ] $+ ] .fakedonation.status == Off ) { return }
n330=  if ( $ isin $1- || donate isin $1-) {
n331=    timeout $chan fakedonation $nick
n332=  }
n333=}
