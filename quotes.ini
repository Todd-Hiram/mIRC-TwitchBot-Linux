on *:TEXT:!quote*:#: {
  if (($msgtags(mod).key != 1) && (%floodquote. $+ #) || ($($+(%,floodquote.,$2),2)))) { return }
  set -u15 %floodquote. $+ #  On
  if (!$2) { 
    msg # $read(# $+ quotes.txt,n) 
  }
  elseif ($2 == add) && ($3) && ($msgtags(mod).key == 1) { .write # $+ quotes.txt $replace($3-,|,$chr(124)) | msg # [Quote Added] $+($lines(# $+ quotes.txt),:) $3- } 
  elseif ($2 == del) && ($3 isnum) && ($lines(# $+ quotes.txt) >= $3) && ($msgtags(mod).key == 1) { msg # [Quote Deleted] $3 $+ : $read(# $+ quotes.txt, $+ $3) | .write -dl $+ $3 # $+ quotes.txt }
  elseif ($2 isnum) && ($lines(# $+ quotes.txt) >= $2) { msg # [Quote $+($2,/,$lines(# $+ quotes.txt),]) $read(# $+ quotes.txt,n,$2) }   
  elseif ($2 == find) && ($len($3) > 2) {
    var %x $lines(# $+ quotes.txt)
    while (%x) {
      if ($3- isin $read(# $+ quotes.txt,%x)) {
        inc %quotes.search
        set %quotes.return $addtok(%quotes.return,%x,32)
      }
      dec %x
    }
    if (!%quotes.search) { msg # [Quote Search] No quotes found with the phrase " $+ $3- $+ " | unset %quotes.* | halt }
    if (%quotes.search = 1) { msg # [Quote Search] One quote found: $+([,%quotes.return,]) $read(quotes.txt,n,%quotes.return) | unset %quotes.* }
    else {
      msg # [Quote Search] Found %quotes.search quotes that have the phrase $+(",$3-,") in them.
      .timer 1 2 msg # [Quote $+($gettok(%quotes.return,1,32),/,$lines(quotes.txt),])  $replace($read(quotes.txt, n, $gettok(%quotes.return,1,32)),|,$!chr(124))   
      .timer 1 4 msg # [Quote Search] Other quote numbers: $right(%quotes.return,-2)
      unset %quotes.*
    }
  }
}
}
