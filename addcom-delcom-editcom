on *:text:!addcom *:#: {
  if ($msgtags(mod).key == 1) {
    var %r = $read(# $+ commands.txt,ns,$2)
    if (%r) { .msg $chan [ $+ $nick $+ ]: Error, This command $qt($2) is already exist into the database! | return }
    if ([count] isin $3-) {
    set %count. [ $+ [ $2 ] $+ ] . [ $+ [ # ] ] 1 | goto next }
    :next
    write # $+ commands.txt $2-
    msg $chan /me + Command $2 has been added to the database!
  }
}
on *:text:!delcom *:#: {
  if ($msgtags(mod).key == 1) {
    var %r = $read(# $+ commands.txt,ns,$2)
    if (!%r) { .msg $chan [ $+ $nick $+ ]: Error, This command $qt($2) does NOT exist into the database! | return }
    write -dl $+ $readn # $+ commands.txt
    msg $chan /me - Command $2 has been deleted from the database!
  }
}
on *:text:!editcom & *:#: {
  if ($msgtags(mod).key == 1)  {
    var %r = $read(# $+ commands.txt,ns,$2)
    if (!%r) { .msg $chan [ $+ $nick $+ ]: Error, This command $qt($2) does NOT exist into the database! | return }
    write -l $+ $readn # $+ commands.txt $2-
    msg $chan /me -> Command $2 has been updated!
  }
}

ON *:TEXT:*:#: {
  var %owner $right(#,-1)
  tokenize 32 $strip($1-,burci)
  if ($read(# $+ commands.txt, nts, $1)) {
    var %com = $v1
    var %com = $replace(%com,@touser@,$iif($2,$2,?),@user@,$nick,@target@,$target)
    if (-ul=sub == $gettok(%com,1,32)) && (($msgtags(mod).key != 1) && ($msgtags(subscriber).key != 1)) { return }
    if (-ul=reg == $gettok(%com,1,32)) && (($msgtags(mod).key != 1) && (Regular. $+ # !isin $level($nick)))  { return }
    if (-ul=mod == $gettok(%com,1,32)) && ($msgtags(mod).key != 1) { return }
    if (-ul=own == $gettok(%com,1,32)) && ($nick != %owner) { return }
    if ($msgtags(mod).key == 1) && ($timer(floodcommod. $+ $1 $+ # )) { return }
    elseif ($msgtags(mod).key != 1) && ($timer(floodcom. $+ $1 $+ #)) { return }
    timer $+ floodcommod. $+ $1 $+ # 1 5 On
    timer $+ floodcom. $+ $1 $+ # 1 15 On
    if ([count] isin %com) { 
      var %newcount = $calc(%count. [ $+ [ $1 ] $+ ] . [ $+ [ # ] ] + 1)
      set %count. [ $+ [ $1 ] $+ ] . [ $+ [ # ] ]  %newcount
      var %com $reptok(%com, [count], %newcount, 1, 32) 
      goto cont
    }
    else {
      :cont
      msg $chan $iif(-ul=reg == $gettok(%com,1,32) || -ul=mod == $gettok(%com,1,32) || -ul=own == $gettok(%com,1,32) || -ul=sub == $gettok(%com,1,32),$gettok(%com,2-,32),$gettok(%com,1-,32))
      if ( !commands == $1 ) && ( $msgtags(mod).key == 1) { msg # .w $nick A list of commands to setup the bot can be found here: https://goo.gl/o1Otwc }
    }
  }
}
